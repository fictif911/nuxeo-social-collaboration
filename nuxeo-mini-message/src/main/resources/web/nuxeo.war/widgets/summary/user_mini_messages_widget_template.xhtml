<div xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  id="#{widget.id}">

  <c:set var="userSchema" value="#{userManager.userSchemaName}" />
  <c:set var="userIdField" value="#{userManager.userIdField}" />

  <c:if test="#{widget.handlingLabels}">
    <c:if test="#{!empty widget.label}">
      <ui:include src="/widgets/incl/widget_label_template.xhtml">
        <ui:param name="labelStyleClass" value="summaryTitle #{widgetProperty_headerStyleClass}" />
      </ui:include>
    </c:if>
    <c:if test="#{empty widget.label}">
      <ui:include src="/widgets/incl/label_template.xhtml">
        <ui:param name="label" value="mini.messages.tab.view" />
        <ui:param name="helpLabel" value="#{widget.helpLabel}" />
        <ui:param name="translated" value="true" />
        <ui:param name="required" value="#{widget.required}" />
        <ui:param name="labelStyleClass" value="summaryTitle #{widgetProperty_headerStyleClass}" />
      </ui:include>
    </c:if>
  </c:if>

  <div class="gadgets-gadget-chrome gadgets gadget-user-mini-messages fullWidth"></div>

  <script type="text/javascript">
    jQuery('.gadget-user-mini-messages').openSocialGadget({
      baseURL: '#{baseURL}',
      language: '#{localeSelector.language}',
      gadgetDefs: [
        { specUrl: '#{gadgetsBaseURL}/site/gadgets/minimessages/minimessages.xml',
          title: '#{nxu:javaScriptEscape(messages['mini.messages.tab.view'])}',
          userPrefs: {
            miniMessagesStreamType: {
              value: 'fromActor'
            },
            actor: {
              value: '#{value[userSchema][userIdField]}'
            }
          },
          displayTitleBar: false,
          width: '100%'
        }
      ]
    });
  </script>

</div>
